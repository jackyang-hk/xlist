/*!build time : 2014-04-17 3:32:00 PM*/
KISSY.add("gallery/xlist/1.0/drag",function(a){function b(a){return a.changedTouches.length>1?void(m=!0):(h=[],g={},g.startX=a.changedTouches[0].clientX,g.startY=a.changedTouches[0].clientY,g.deltaX=0,g.deltaY=0,a.touch=g,h.push({deltaX:g.deltaX,deltaY:g.deltaY,timeStamp:a.timeStamp}),a.deltaX=g.deltaX,a.deltaY=g.deltaY,void n(a.target).fire(i,a))}function c(a){a.changedTouches.length>1||(g.deltaX=a.changedTouches[0].clientX-g.startX,g.deltaY=a.changedTouches[0].clientY-g.startY,a.touch=g,h.push({deltaX:g.deltaX,deltaY:g.deltaY,timeStamp:a.timeStamp}),a.deltaX=g.deltaX,a.deltaY=g.deltaY,n(a.target).fire(k,a))}function d(a){var b=0,c=0,d=0;if(!(a.changedTouches.length>1)){g.deltaX=a.changedTouches[0].clientX-g.startX,g.deltaY=a.changedTouches[0].clientY-g.startY,a.deltaX=g.deltaX,a.deltaY=g.deltaY,a.touch=g,a.touch.record=h;{var i=(a.touch.startX,a.touch.startY,h.length);h[0].timeStamp}if(!(2>i)){{h[i-1].timeStamp-h[0].timeStamp}for(var k in h)k>0?(h[k].velocity=e(h[k].deltaX,h[k].deltaY,h[k-1].deltaX,h[k-1].deltaY)/(h[k].timeStamp-h[k-1].timeStamp),h[k].velocityX=(h[k].deltaX-h[k-1].deltaX)/(h[k].timeStamp-h[k-1].timeStamp),h[k].velocityY=(h[k].deltaY-h[k-1].deltaY)/(h[k].timeStamp-h[k-1].timeStamp)):(h[k].velocity=0,h[k].velocityX=0,h[k].velocityY=0);var m=h[0].velocityX/Math.abs(h[0].velocityX);for(var k in h)h[k].velocityX/Math.abs(h[k].velocityX)!=m&&(m=h[k].velocityX/Math.abs(h[k].velocityX),d=k);var o=h[0].velocityY/Math.abs(h[0].velocityY);for(var k in h)h[k].velocityY/Math.abs(h[k].velocityY)!=o&&(o=h[k].velocityY/Math.abs(h[k].velocityY),c=k);b=Math.max(d,c);{h[b]}a.touch.record=a.touch.record.splice(b-1);var p=f(a.touch.record);a.velocityX=Math.abs(p.velocityX)>l?p.velocityX/Math.abs(p.velocityX)*l:p.velocityX,a.velocityY=Math.abs(p.velocityY)>l?p.velocityY/Math.abs(p.velocityY)*l:p.velocityY,a.velocity=Math.sqrt(Math.pow(a.velocityX,2)+Math.pow(a.velocityY,2)),n(a.target).fire(j,a)}}}function e(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function f(a){for(var b=0,c=0,d=a.length,e=0;d>e;e++)b+=a[e].velocityY,c+=a[e].velocityX;return b/=d,c/=d,{velocityY:b,velocityX:c}}var g,h,i=(window.document,"gestureDragStart"),j="gestureDragEnd",k="gestureDrag",l=8,m=!1,n=a.all;return a.each([k],function(e){a.Event.Special[e]={setup:function(){n(this).on("touchstart",b),n(this).on("touchmove",c),n(this).on("touchend",d)},teardown:function(){n(this).detach("touchstart",b),n(this).detach("touchmove",c),n(this).detach("touchend",d)}}}),{DRAG_START:i,DRAG:k,DRAG_END:j}},{requires:["node"]}),KISSY.add("gallery/xlist/1.0/index",function(a,b,c,d,e,f){function g(a,b){return[[(a/3+(a+b)/3-a)/(b-a),(a*a/3+a*b*2/3-a*a)/(b*b-a*a)],[(b/3+(a+b)/3-a)/(b-a),(b*b/3+a*b*2/3-a*a)/(b*b-a*a)]]}var h=a.all,i="ks-xlist-",j=i+"container",k=new RegExp(j),l=d.extend({initializer:function(){var b=this,c=b.userConfig=a.mix({data:[],translate3D:!1,autoRender:!0,itemHeight:30},b.userConfig,void 0,void 0,!0);b.$renderTo=h(c.renderTo).css({overflowY:"hidden"});b.height=c.height||b.$renderTo.height();b.visibleIndex={},b.__renderIdRecord={},b.__boundryCheckEnabled=!0,b.initItemPool(),c.autoRender&&b.render()},translateY:function(a,b){var c=this;a.style.webkitTransform=c.userConfig.translate3D?"translate3D(0,"+b+"px,0)":"translateY("+b+"px)"},removeData:function(){var a=this;a.userConfig.data=[]},setData:function(a){for(var b=this,c=0,d=a.length;d>c;c++)b.userConfig.data.push(a[c])},getDomInfo:function(){for(var a=this,b=a.userConfig,c=b.stickies||{},d=b.data,e=b.itemHeight,f=0,g=[],h=function(){var a=0;for(var b in c)a++;return d.length+a}(),i=0,j=0,k=0;h>k;k++){var l={};k in c?(j++,i=c[k].height,l.type=c[k].type||2,l.template=c[k].template||""):(i=e,l.data=d[k-j],l.template=b.template,l.type=1),l.row=k,l.top=f,l.height=i,g.push(l),f+=i}return a.domInfo=g,g},getItemObj:function(a,b,c){var d=this,b=(d.velocityY||0,d.height),e=d.userConfig,f=d.userConfig.itemHeight,g=e.maxBufferedNum||Math.ceil(d.height/f),h=a-g*f;0>h&&(h=0);for(var i,j={},k=0,l=c.length;l>k;k++)i=c[k],i.top>=h&&i.top<=h+2*g*f+b&&(j[k]=i);return j},getOffsetTop:function(){var a=this;return a.$ctn&&a.$ctn[0]?Number(window.getComputedStyle(a.$ctn[0]).webkitTransform.match(/[-\d]+/g)[5]):0},update:function(){var a=this,b=a.userConfig,c=a.$ctn[0],d=a.itemPool,e=(b.itemHeight,a.height),f=-a.getOffsetTop(c),g=a.getItemObj(f,e,a.domInfo);for(var h in g){var i=null;a.visibleIndex[h]||2==g[h].type||(i=d.getItem(g[h]),i.element.style.position="absolute",i.element.style.height=g[h].height+"px",a.translateY(i.element,g[h].top),a.visibleIndex[h]=i)}for(var h in a.visibleIndex)a.hasKey(g,h)||(d.returnItem(a.visibleIndex[h]),delete a.visibleIndex[h]);a.isScrolling&&(a.updateItv=setTimeout(function(){a.update(),a.fire("scroll")},0))},clear:function(){var a=this;for(var b in a.__renderDomRecord)a.__renderDomRecord[b].remove();a.visibleIndex={},a.__renderIdRecord={}},hasKey:function(a,b){for(var c in a)if(c===b)return!0;return!1},initItemPool:function(){var b=this;b.__renderDomRecord=[];{var c=b.userConfig;b.itemPool={items:[],getItem:function(d){var f;return this.items.length?(f=this.items.pop(),f.element.innerHTML=a.isFunction(c.renderHook)?c.renderHook({item:f,data:d.data}).innerHTML:h(e(d.template).render(d.data)).html()):(f={template:d.template},f.element=a.isFunction(c.renderHook)?c.renderHook({item:f,data:d.data}):h(e(d.template).render(d.data))[0],b.__renderDomRecord.push(h(f.element).appendTo(b.$ctn))),f},returnItem:function(a){this.items.push(a)}}}},enableBoundryCheck:function(){var a=this;a.__boundryCheckEnabled=!0,a.boundryCheck()},disableBoundryCheck:function(){var a=this;a.__boundryCheckEnabled=!1},scrollTo:function(a,b){var c=this,b=b||0;b>1&&(b/=1e3);var d=c.$ctn[0];c.translateY(d,(-a).toFixed(0)),d.style.webkitTransition="-webkit-transform "+b+"s ease-in-out 0s",c.isScrolling=!0,c.update()},boundryCheck:function(){var a=this;if(a.__boundryCheckEnabled){var b=a.$ctn[0],c=a.height,d=a.getOffsetTop(b);d>0&&(b.style.webkitTransition="-webkit-transform 0.4s ease-in-out 0s",a.translateY(b,0),a.isScrolling=!0),d<c-a.containerHeight&&(b.style.webkitTransition="-webkit-transform 0.4s ease-in-out 0s",a.translateY(b,c-a.containerHeight),a.isScrolling=!0),a.update()}},_createContainer:function(){var a=this;if(!a.__isContainerCreated){var b,c=a.$renderTo;h("."+j,a.$renderTo)[0]?b=h("."+j,a.$renderTo)[0]:(b=document.createElement("div"),b.className=j,c[0].appendChild(b)),b.style.background="white",b.style.width="100%",b.style.position="relative",b.style["z-index"]=1,a.translateY(b,0),b.style.webkitBackfaceVisibility="hidden",b.style.webkitPerspective=1e3,a.$ctn=h(b),a.__isContainerCreated=!0}},sync:function(){{var a=this,b=a.userConfig;a.height=b.height||a.$renderTo.height()}a.render()},render:function(){var a=this;a.getDomInfo(),a._createContainer();var b=(a.userConfig,a.domInfo.length),c=a.domInfo[b-1],d=(a.$renderTo,a.$ctn),e=d[0];a.containerHeight=c&&c.top?c.top+c.height:a.height,a.containerHeight<a.height&&(a.containerHeight=a.height);for(var f=0,g=a.domInfo.length;g>f;f++)if(2==a.domInfo[f].type&&!a.__renderIdRecord[a.domInfo[f].row]){var h=document.createElement("div");h.style.top=0,h.style.width="100%",h.style.height=a.domInfo[f].height,h.style.position="absolute",a.translateY(h,a.domInfo[f].top),h.innerHTML=a.domInfo[f].template||"",e.appendChild(h),a.__renderIdRecord[a.domInfo[f].row]=1}d.height(a.containerHeight),a._bindEvt(),a.update()},_bindEvt:function(){function a(a){var b=a.velocityY;if(c.velocityY=b,Math.abs(b)<.5)return c.fire("panEnd"),void c.boundryCheck();var d=c.height,e=c.getOffsetTop(l),f=i.maxSpeed>0&&i.maxSpeed<6?i.maxSpeed:3;if(b>f&&(b=f),-f>b&&(b=-f),c.direction=a.velocityY<0?"up":"down",c.fire("flick",{velocityY:a.velocityY}),e>0||e<d-c.containerHeight){var j=.08*(b/Math.abs(b)),k=b/j,e=c.getOffsetTop(l),m=e+k*b/2;return l.style.webkitTransition="-webkit-transform "+k.toFixed(0)+"ms cubic-bezier("+g(-k,0)+") 0s",void c.translateY(l,m.toFixed(0))}var j=.002*(b/Math.abs(b)),k=b/j,m=e+k*b/2;if(m>0){var n=0-e,o=(b-Math.sqrt(-2*j*n+b*b))/j;l.style.webkitTransition="-webkit-transform "+o.toFixed(0)+"ms cubic-bezier("+g(-k,-k+o)+") 0s",c.translateY(l,0),h=b-j*o}else if(m<d-c.containerHeight){var n=d-c.containerHeight-e,o=(b+Math.sqrt(-2*j*n+b*b))/j;l.style.webkitTransition="-webkit-transform "+o.toFixed(0)+"ms cubic-bezier("+g(-k,-k+o)+") 0s",c.translateY(l,(d-c.containerHeight).toFixed(0)),h=b-j*o}else l.style.webkitTransition="-webkit-transform "+k.toFixed(0)+"ms cubic-bezier("+g(-k,0)+") 0s",c.translateY(l,m.toFixed(0));c.isScrolling=!0,setTimeout(function(){c.update()},10)}function b(a){if(k.test(a.target.className))if(c.fire("scrollEnd"),c.isScrolling=!1,h){var b=h,d=.04*(b/Math.abs(b)),e=b/d,f=c.getOffsetTop(l),i=f+e*b/2;l.style.webkitTransition="-webkit-transform "+e.toFixed(0)+"ms cubic-bezier("+g(-e,0)+") 0s",c.translateY(l,i.toFixed(0)),h=0}else c.boundryCheck()}var c=this;if(!c.__isEvtBind){c.__isEvtBind=!0;var d,e,h=null,i=c.userConfig,j=c.$ctn,l=j[0],m=c.$renderTo,n=c.height;m.on(f.DRAG_START,function(a){a.preventDefault(),a.changedTouches.length>1||(c.isScrolling=!1,e=a.changedTouches[0].screenY,d=c.getOffsetTop(l),c.translateY(l,d),l.style.webkitTransition="",c.fire("panstart"))}).on(f.DRAG,function(a){if(a.preventDefault(),!(a.changedTouches.length>1)){var b=d/1+a.changedTouches[0].screenY/1-e;b>0&&(b/=2),b<n-c.containerHeight&&(b+=(n-c.containerHeight-b)/2),c.translateY(l,b.toFixed(0)),l.style.webkitTransition="",c.isScrolling=!1,c.fire("pan",{})}}).on(f.DRAG_END,function(b){a(b)}),l.addEventListener("webkitTransitionEnd",b,!1)}}});return l},{requires:["node","event","base","gallery/template/1.0/","./drag"]});